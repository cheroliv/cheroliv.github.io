<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Cheroliv - Développeur Formateur | Ingénierie Pédagogique</title>

        <script>
          // IIFE to avoid polluting global scope
          (function() {
            try {
              const theme = localStorage.getItem('preferred-theme');
              if (theme) {
                document.documentElement.setAttribute('data-bs-theme', theme);
              }
            } catch (e) {
              // Reading from localStorage can fail in private browsing mode on some browsers
              console.warn('Could not set theme from localStorage', e);
            }
          })();
        </script>

        <!-- Bootstrap 5.3 CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />

        <!-- Bootstrap Icons -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" rel="stylesheet" />

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <!-- intl-tel-input CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@25.10.1/build/css/intlTelInput.css">

        <!-- Custom CSS -->
        <link href="../../css/styles.css" rel="stylesheet" />

        <!-- highlight.js: theme will be managed dynamically by script.js -->
<link id="highlight-js-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css">

        <link href="../../css/asciidoctor.css" rel="stylesheet"/>



        <!-- Favicon -->
        <link rel="shortcut icon"
              href="../..//img/cheroliv_logo_icon.png"/>

        

        <!-- Meta tags pour SEO -->
        <meta name="description" content="Développeur formateur spécialisé en ingénierie pédagogique. Conception et développement de solutions e-learning innovantes."/>
        <meta name="keywords" content="développement, formation, e-learning, ingénierie pédagogique, JavaScript, Bootstrap"/>
        <meta name="author" content="Cheroliv"/>

    </head>
<body>
<div class="main-content-wrapper">
    <div>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="../../index.html#home">
                <i class="bi bi-code-slash me-2"></i>
                Cheroliv
            </a>

            <button class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarNav"
                    aria-controls="navbarNav"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-start">
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html#home">Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html#about">À propos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html#services">Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html#expertise">Expertise</a>
                    </li>
<!--                    <li class="nav-item"> -->
<!--                        <a class="nav-link" th:href="${isIndexPage ? '#formations' : content.rootpath + 'index.html#formations'}">Formations</a>-->
<!--                    </li>-->
<!--                    <li class="nav-item">-->
<!--                        <a class="nav-link" th:href="${isIndexPage ? '#portfolio' : content.rootpath + 'index.html#portfolio'}">Portfolio</a>-->
<!--                    </li>-->
                    <li class="nav-item">
                        <a class="nav-link" href="../../blog.html">Blog</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle"
                           href="#"
                           id="memosDropdown"
                           role="button"
                           data-bs-toggle="dropdown"
                           aria-expanded="false">
                            <i class="fa-duotone fa-memo"></i> Memos
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="memosDropdown">
                            <li><a class="dropdown-item" href="../../blog/2022/0052_memo_jvm_post.html"><i class="fa-brands fa-java"></i> jvm</a></li>
                            <li><a class="dropdown-item" href="../../blog/2022/0053_memo_kotlin_post.html"><i class="fa-brands fa-korvue"></i> kotlin</a></li>
                            <li><a class="dropdown-item" href="../../blog/2022/0047_memo_gradle_post.html"><i class="fa-solid fa-industry"></i> gradle</a></li>
                            <li><a class="dropdown-item" href="../../blog/2023/0060_memo_js_post.html"><i class="fa-brands fa-square-js"></i> javascript</a></li>
                            <li><a class="dropdown-item" href="../../blog/2023/0063_memo_ts_post.html"><i class="fa-brands fa-square-js"></i> typescript</a></li>
                            <li><a class="dropdown-item" href="../../blog/2023/0062_memo_css_post.html"><i class="fa-brands fa-css3-alt"></i> css</a></li>
                            <li><a class="dropdown-item" href="../../blog/2023/0061_memo_html_post.html"><i class="fa-brands fa-html5"></i> html</a></li>
                            <li><a class="dropdown-item" href="../../blog/2023/0066_memo_python_post.html"><i class="fa-brands fa-python"></i> python</a></li>
                            <li><a class="dropdown-item" href="../../blog/2020/0021_memo_git_post.html"><i class="fa-brands fa-git-alt"></i> git</a></li>
                            <li><a class="dropdown-item" href="../../blog/2021/0030_memo_linux_post.html"><i class="fa-brands fa-linux"></i> linux</a></li>
                            <li><a class="dropdown-item" href="../../blog/2022/0054_memo_cadrage_post.html"><i class="fa-solid fa-arrows-split-up-and-left"></i> cadrage</a></li>
                            <li><a class="dropdown-item" href="../../blog/2022/0031_memo_design_system_post.html"><i class="fa-solid fa-pencil"></i> design system</a></li>
                            <li><a class="dropdown-item" href="../../blog/2020/0016_asciidoc_markdown_memo_post.html"><i class="fa-brands fa-markdown"></i> asciidoc/markdown</a></li>
                            <li><a class="dropdown-item" href="https://pages-content.github.io/slides/" target="_blank"><i class="fa-regular fa-file-powerpoint"></i> slides</a></li>
                            <li><a class="dropdown-item" href="https://talaria-formation.github.io/formations/index.html" target="_blank"><i class="fa-solid fa-graduation-cap"></i> trainings</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html#contact">Contact</a>
                    </li>
                </ul>
                <!-- Theme Switcher moved outside the ul for simpler flexbox calculation -->
                <div class="nav-item dropdown theme-switcher-container ms-lg-3">
                    <button class="btn btn-outline-secondary dropdown-toggle theme-dropdown-btn"
                            type="button"
                            id="themeDropdown"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                            aria-label="Sélectionner le thème de l'interface">
                        <i class="bi bi-sun"></i>
                        <span id="current-theme" class="visually-hidden">Light</span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="themeDropdown">
                        <li><button class="dropdown-item theme-option"
                                    type="button"
                                    data-theme="light">
                            <i class="bi bi-sun me-2"></i>Light
                        </button></li>
                        <li><button class="dropdown-item theme-option" type="button" data-theme="dark">
                            <i class="bi bi-moon me-2"></i>Dark
                        </button></li>
                        <li><button class="dropdown-item theme-option" type="button" data-theme="high-contrast">
                            <i class="bi bi-circle-half me-2"></i>High Contrast
                        </button></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
</div>
    <main class="container main-content-padding" id="main-content">
        <article>
            <header class="page-header mb-4">
                <h1 class="h2">Article 3 : Intégration de Jackson pour le Parsing YAML avec TDD dans un Plugin Gradle</h1>
                <p class="lead">
                    <em>Publié le 25 September 2025</em>
                </p>
            </header>

            <div class="content"><div id="toc" class="toc">
<div id="toctitle">Sommaire</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_1_le_contexte_notre_plugin_site_baker">2. 1. Le Contexte : Notre Plugin <code>site-baker</code></a></li>
<li><a href="#_2_modélisation_de_la_configuration_en_kotlin">3. 2. Modélisation de la Configuration en Kotlin</a></li>
<li><a href="#_3_intégration_de_jackson_dans_le_build_gradle_kts">4. 3. Intégration de Jackson dans le <code>build.gradle.kts</code></a></li>
<li><a href="#_4_lapproche_tdd_tester_le_parsing_yaml">5. 4. L&#8217;Approche TDD : Tester le Parsing YAML</a>
<ul class="sectlevel2">
<li><a href="#_4_1_test_unitaire_mapper_le_yaml_en_objet_kotlin">5.1. 4.1. Test Unitaire : Mapper le YAML en Objet Kotlin</a></li>
<li><a href="#_4_2_test_fonctionnel_valider_la_lecture_du_fichier_de_configuration">5.2. 4.2. Test Fonctionnel : Valider la Lecture du Fichier de Configuration</a></li>
</ul>
</li>
<li><a href="#_5_visualisation_du_flux_de_parsing">6. 5. Visualisation du Flux de Parsing</a></li>
<li><a href="#_conclusion">7. Conclusion</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Public cible : Développeurs Gradle intermédiaires souhaitant gérer des configurations complexes.</div>
<p>Dans le développement de plugins Gradle, la gestion de configurations complexes est une tâche courante. Plutôt que de surcharger le DSL avec des centaines de propriétés, il est souvent plus propre et plus maintenable de définir la configuration dans un fichier externe, comme le YAML. Cet article vous guide à travers l&#8217;intégration de la puissante bibliothèque Jackson pour parser des fichiers YAML en objets Kotlin, en adoptant une approche TDD rigoureuse pour garantir la robustesse de notre plugin <code>site-baker</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_le_contexte_notre_plugin_site_baker">2. 1. Le Contexte : Notre Plugin <code>site-baker</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Notre plugin <code>site-baker</code> est conçu pour automatiser la génération et le déploiement d&#8217;un site statique. Il a besoin de lire un fichier de configuration YAML (<code>managed-jbake-context.yml</code>) pour obtenir des informations telles que les chemins des sources, les destinations de déploiement, et les identifiants Git.</p>
</div>
<div class="paragraph">
<p>La configuration YAML que nous souhaitons parser ressemble à ceci :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">bake:
  srcPath: "./site/jbake"
  destDirPath: "bake"
  cname: "cheroliv.com"
pushPage:
  from: "bake"
  to: "cvs"
  repo:
    name: "trainings"
    repository: "https://github.com/pages-content/pages-content.github.io.git"
    credentials:
      username: "USERNAME"
      password: "SECRET_TOKEN"
  branch: "main"
  message: "cheroliv.com"
# ... autres configurations (pushMaquette, supabase, etc.)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_modélisation_de_la_configuration_en_kotlin">3. 2. Modélisation de la Configuration en Kotlin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Avant de parser, nous devons définir la structure de nos données en Kotlin. Jackson utilisera ces classes pour mapper automatiquement le contenu YAML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">// plugin/src/main/kotlin/com/cheroliv/site/baker/data/SiteConfiguration.kt
package com.cheroliv.site.baker.data

import com.fasterxml.jackson.databind.ObjectMapper
import com.fasterxml.jackson.dataformat.yaml.YAMLFactory
import com.fasterxml.jackson.module.kotlin.readValue
import com.fasterxml.jackson.module.kotlin.registerKotlinModule

fun parseSiteConfiguration(yaml: String): SiteConfiguration {
    val mapper = ObjectMapper(YAMLFactory()).registerKotlinModule()
    return mapper.readValue(yaml)
}

data class GitPushConfiguration(
    val from: String = "",
    val to: String = "",
    val repo: RepositoryConfiguration = RepositoryConfiguration(),
    val branch: String = "",
    val message: String = "",
)

data class RepositoryConfiguration(
    val name: String = "",
    val repository: String = "",
    val credentials: RepositoryCredentials = RepositoryCredentials(),
) {
    companion object {
        const val ORIGIN = "origin"
        const val CNAME = "CNAME"
        const val REMOTE = "remote"
    }
}

data class RepositoryCredentials(val username: String = "", val password: String = "")

data class SiteConfiguration(
    val bake: BakeConfiguration = BakeConfiguration(),
    val pushPage: GitPushConfiguration = GitPushConfiguration(),
    val pushMaquette: GitPushConfiguration = GitPushConfiguration(),
    val pushSource: GitPushConfiguration? = null,
    val pushTemplate: GitPushConfiguration? = null,
    val supabase: SupabaseContactFormConfig? = null
)

data class BakeConfiguration(
    val srcPath: String = "",
    val destDirPath: String = "",
    val cname: String? = null,
)

// ... (autres data classes pour Supabase, si nécessaire)</code></pre>
</div>
</div>
<div class="paragraph">
<p>La fonction <code>parseSiteConfiguration</code> est notre point d&#8217;entrée pour la désérialisation. Elle utilise <code>ObjectMapper</code> de Jackson, configuré avec <code>YAMLFactory</code> pour le format YAML et <code>registerKotlinModule()</code> pour le support des spécificités de Kotlin (comme les valeurs par défaut des propriétés).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_intégration_de_jackson_dans_le_build_gradle_kts">4. 3. Intégration de Jackson dans le <code>build.gradle.kts</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour utiliser Jackson, nous devons ajouter les dépendances nécessaires dans le <code>build.gradle.kts</code> de notre module <code>plugin</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">// plugin/build.gradle.kts
dependencies {
    // Jackson for YAML parsing
    implementation("com.fasterxml.jackson.module:jackson-module-kotlin:2.18.3")
    implementation("com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.18.3")

    // ... autres dépendances
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous utilisons <code>jackson-module-kotlin</code> pour le support de Kotlin et <code>jackson-dataformat-yaml</code> pour la gestion du format YAML.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_lapproche_tdd_tester_le_parsing_yaml">5. 4. L&#8217;Approche TDD : Tester le Parsing YAML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maintenant, appliquons le TDD pour valider notre logique de parsing.</p>
</div>
<div class="sect2">
<h3 id="_4_1_test_unitaire_mapper_le_yaml_en_objet_kotlin">5.1. 4.1. Test Unitaire : Mapper le YAML en Objet Kotlin</h3>
<div class="paragraph">
<p>Nous commençons par un test unitaire dans <code>SiteBakerPluginTest.kt</code> pour vérifier que la fonction <code>parseSiteConfiguration</code> peut correctement transformer une chaîne YAML en un objet <code>SiteConfiguration</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">// plugin/src/test/kotlin/com/cheroliv/site/baker/SiteBakerPluginTest.kt
@Test
fun `can map configuration text to SiteConfiguration object`() {
    val yamlString = "../../managed-jbake-context.yml"
        .run(::File)
        .readText()
        .trimIndent()

    val config: SiteConfiguration = parseSiteConfiguration(yamlString)

    assertEquals("cheroliv.com", config.bake.cname)
    assertEquals("main", config.pushPage.branch)
    assertEquals("https://github.com/pages-content/pages-content.github.io.git", config.pushPage.repo.repository)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce test lit le contenu du fichier <code>managed-jbake-context.yml</code> (qui doit exister pour que le test soit valide) et effectue des assertions sur l&#8217;objet <code>SiteConfiguration</code> résultant. Il valide que les valeurs clés du YAML sont correctement mappées.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_test_fonctionnel_valider_la_lecture_du_fichier_de_configuration">5.2. 4.2. Test Fonctionnel : Valider la Lecture du Fichier de Configuration</h3>
<div class="paragraph">
<p>Pour s&#8217;assurer que le plugin peut lire le fichier de configuration via son DSL et que le parsing fonctionne dans un environnement Gradle réel, nous ajoutons un test fonctionnel dans <code>SiteBakerPluginFunctionalTest.kt</code>.</p>
</div>
<div class="paragraph">
<p>Ce test est crucial car il simule l&#8217;exécution du plugin dans un projet réel. Il doit être <strong>hermétique</strong>, c&#8217;est-à-dire qu&#8217;il doit créer lui-même le fichier <code>managed-jbake-context.yml</code> avec un contenu contrôlé, pour garantir la reproductibilité et l&#8217;isolation du test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">// plugin/src/functionalTest/kotlin/com/cheroliv/site/baker/SiteBakerPluginFunctionalTest.kt
@Test
fun `config file contains good data`(){
    val configContent = configFile.readText(UTF_8)
    // Vérifications comme dans vos commentaires
    assertTrue(configContent.contains("bake"))
    assertTrue(configContent.contains("pushPage"))
    assertTrue(configContent.contains("repository"))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce test fonctionnel vérifie que le fichier de configuration copié dans le répertoire temporaire du test contient les données attendues. Bien que ce test ne parse pas directement le YAML en objet Kotlin, il valide la présence du fichier et de son contenu, ce qui est une étape préalable essentielle au parsing par le plugin.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_visualisation_du_flux_de_parsing">6. 5. Visualisation du Flux de Parsing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le diagramme suivant illustre le flux de données et les interactions lors du parsing de la configuration YAML :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="diag-plantuml-md5-0994e4ea85b7366b45651fc9303bc947.png" alt="Diagram" width="1523" height="472">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">7. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En suivant une approche TDD, nous avons intégré avec succès la bibliothèque Jackson pour parser des fichiers de configuration YAML en objets Kotlin au sein de notre plugin Gradle. Cette méthode nous a permis de :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Modéliser clairement</strong> notre configuration avec des data classes Kotlin.</p>
</li>
<li>
<p><strong>Valider la logique de parsing</strong> avec des tests unitaires ciblés.</p>
</li>
<li>
<p><strong>Assurer l&#8217;intégration</strong> dans un environnement Gradle réel grâce à des tests fonctionnels hermétiques.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cette base solide nous offre une grande confiance pour étendre notre plugin avec des fonctionnalités qui s&#8217;appuient sur cette configuration, tout en garantissant la maintenabilité et la robustesse du code. Le parsing YAML est désormais une fonctionnalité fiable et testée de notre plugin <code>site-baker</code>.</p>
</div>
</div>
</div></div>

            <!-- Section Commentaires Disqus -->
            <section id="disqus_thread" class="mt-5"></section>
            <script>
                /*<![CDATA[*/
                var disqus_identifier = "blog\/2025\/0091_jackson_yaml_tdd_post.html";

                (({disqus_shortname, document}) => {
                    injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
                    injectScript('//' + disqus_shortname + '.disqus.com/count.js');

                    function injectScript(url) {
                        const s = document.createElement('script');
                        s.async = true;
                        s.src = url;
                        (document.head || document.body).appendChild(s);
                    }
                })({'disqus_shortname': 'cheroliv', 'document': document});
                /*]]>*/
            </script>
            <noscript>
                <div class="alert alert-warning">
                    Veuillez activer JavaScript pour voir les
                    <a href="https://disqus.com/?ref_noscript" class="alert-link">commentaires propulsés par Disqus</a>.
                </div>
            </noscript>

        </article>
    </main>
</div>

<div>
    <!-- Footer -->
    <footer class="bg-light-theme py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2018-<span>2025</span> Cheroliv. Tous droits
                        réservés.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="https://github.com/cheroliv" target="_blank" class="me-3" aria-label="Profil GitHub" data-bs-toggle="tooltip" data-bs-placement="top" title="github/cheroliv"><i class="fa-brands fa-github fa-lg"></i></a>
                    <a href="../../feed.xml" aria-label="Flux RSS" data-bs-toggle="tooltip" data-bs-placement="top" title="flux RSS"><i class="fa-solid fa-rss fa-lg"></i></a>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap 5.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Supabase Credentials Injection -->
    <script>
        /*<![CDATA[*/
        const SUPABASE_URL = null;
        const SUPABASE_KEY = null;
        /*]]>*/
    </script>
    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script>
    <!-- intl-tel-input JS -->
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@25.10.1/build/js/intlTelInput.min.js"></script>
    <!-- Custom JS -->
    <script src="../../js/script.js"></script>
</div>
</body>
</html>
